---
services:
  calibre:
    image: lscr.io/linuxserver/calibre:latest
    container_name: calibre
      #security_opt:
      #- seccomp=unconfined
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/Chicago
    volumes:
      - calibre-config:/config
      - type: volume
        source: mnt-public
        target: /mnt/eBooks
        volume:
          subpath: eBooks
    restart: unless-stopped

  calibre-web:
    image: lscr.io/linuxserver/calibre-web:latest
    container_name: calibre-web
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/Chicago
      - OATHLIB_RELAX_TOKEN_SCOPE=1
    volumes:
      - calibre-web-config:/config
      - type: volume
        source: mnt-public
        target: /books
        volume:
          subpath: eBooks
    restart: unless-stopped

volumes:
  calibre-config:
    driver: local
    driver_opts:
      type: nfs
      o: addr=fileserver.localdomain.lan,rw,vers=4.1
      device: ":/srv/docker/calibre/calibre-config"    
  calibre-web-config:
    driver: local
    driver_opts:
      type: nfs
      o: addr=fileserver.localdomain.lan,rw,vers=4.1
      device: ":/srv/docker/calibre/calibre-web-config"    
  mnt-public:
    external: true


networks:
  default:
    external: true
    name: calibre
